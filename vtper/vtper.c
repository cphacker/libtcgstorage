/////////////////////////////////////////////////////////////////////////////
/// vtper.c
///
/// implementation of virtual tper
///
/// (c) Artem Zankovich, 2012
//////////////////////////////////////////////////////////////////////////////
#ifndef _TCGS_VTPER_H
#define _TCGS_VTPER_H

#include <string.h>

#include "tcgs_types.h"
#include "tcgs_interface.h"

void TCGS_VTPer_Init(void)
{
	return;
}

// see section 3.2.1.1.1 (Response) of Application Note for description of the package
uint8 appnote_response_level0discovery[] =
{
	0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x01, 0x10, 0x0C, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x02, 0x10, 0x0C, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x02, 0x00, 0x10, 0x10, 0x07, 0xFE, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

TCGS_InterfaceError_t TCGS_VTPER_SendCommand(
    TCGS_CommandBlock_t *inputCommandBlock,  void *inputPayload,
    TCGS_InterfaceError_t *tperError, void *outputPayload)
{
	if (inputCommandBlock->command == IF_SEND)
	{

	}
	else
	{
		switch(inputCommandBlock->protocolId)
			{
			case 0x01:
				if (inputCommandBlock->comId == 0x01)
				{
					//Level 0 Discovery
					//TODO: replace 100 with actual buffer length
					memset(outputPayload, 0, 100);
					memcpy(outputPayload, appnote_response_level0discovery, sizeof(appnote_response_level0discovery));
				}
				break;
			}
	}

	*tperError = INTERFACE_ERROR_GOOD;
	return ERROR_SUCCESS;
}

#endif //_TCGS_VTPER_H
